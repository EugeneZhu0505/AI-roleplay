<xaiArtifact artifact_id="92cfca14-d141-4b72-898b-15403fa9ba1c" artifact_version_id="d92b1f10-5f23-4b76-a4e2-9397e2b460fa" title="Functional_Architecture_Document.md" contentType="text/markdown">

# AI Roleplay 项目功能架构文档

## 1. 概述

AI Roleplay 是一个人工智能驱动的角色扮演全栈 Web 应用，基于 Spring Boot WebFlux 后端和 React 前端，提供交互式角色扮演体验。前后端通过 RESTful API 通信，数据存储于 MySQL，Redis 用于缓存，Spring Security 和 JWT 保障安全。本文档以功能模块为核心，描述项目的架构划分及各模块职责。

## 2. 系统架构

项目采用客户端-服务器架构，功能模块分为前端和后端，通过 RESTful API 实现交互。主要组件包括：

- **前端**：React 单页应用（SPA），提供用户界面和交互。
- **后端**：Spring Boot WebFlux，提供响应式 API 处理业务逻辑。
- **数据库**：MySQL，存储用户、角色扮演场景等数据。
- **缓存**：Redis，提升高频数据访问性能。

## 3. 功能模块划分

以下按功能模块划分架构，涵盖核心功能及其实现方式。

### 3.1. 用户管理模块
- **职责**：
  - 用户注册、登录、注销。
  - 用户信息管理（如修改资料、密码）。
  - 角色权限管理（如普通用户、管理员）。
- **后端实现**：
  - **控制层**：提供注册、登录、用户信息更新的 RESTful API，使用 JWT 进行认证。
  - **服务层**：处理用户认证逻辑，验证输入，生成/验证 JWT。
  - **数据访问层**：通过 MyBatis Plus 操作 MySQL 的用户表。
  - **安全模块**：Spring Security 实现密码哈希和权限控制。
- **前端实现**：
  - **展示层**：使用 Ant Design 和 Material-UI 渲染注册/登录表单、用户资料页面。
  - **API 集成**：通过 Axios/Fetch 调用后端用户相关 API。
  - **状态管理**：使用 React useState 存储用户登录状态和信息。
- **数据存储**：用户信息存储在 MySQL，用户会话缓存至 Redis。

### 3.2. 角色扮演模块
- **职责**：
  - 创建、编辑、删除角色扮演场景。
  - 提供交互式角色扮演体验，生成 AI 驱动的对话或剧情。
  - 保存和加载角色扮演会话。
- **后端实现**：
  - **控制层**：提供场景创建、查询、更新、删除的 API。
  - **服务层**：处理角色扮演逻辑，管理会话状态，可能与 AI 服务交互生成内容。
  - **数据访问层**：操作 MySQL 的场景和会话表。
  - **缓存模块**：Redis 缓存常用场景模板和会话数据。
- **前端实现**：
  - **展示层**：渲染角色扮演界面（如对话框、场景选择），支持动态更新。
  - **API 集成**：调用后端 API 获取/更新场景和会话数据。
  - **状态管理**：使用 React Context API 管理当前会话状态。
- **数据存储**：场景和会话数据存储在 MySQL，热门场景缓存至 Redis。

### 3.3. 认证与授权模块
- **职责**：
  - 用户身份验证（登录、token 验证）。
  - 基于角色的访问控制（如管理员功能限制）。
  - 会话管理（token 刷新、注销）。
- **后端实现**：
  - **控制层**：提供登录、token 刷新、注销的 API。
  - **服务层**：验证用户凭据，生成/验证 JWT，管理会话。
  - **安全模块**：Spring Security 配置拦截器，保护受限 API。
  - **缓存模块**：Redis 存储活跃 JWT 和会话信息。
- **前端实现**：
  - **展示层**：显示登录界面、权限错误提示。
  - **API 集成**：处理 token 获取和存储，添加 token 到请求头。
  - **状态管理**：React useState 存储 token 和用户角色。
- **数据存储**：用户凭据存储在 MySQL，会话 token 缓存至 Redis。

### 3.4. 数据管理模块
- **职责**：
  - 管理用户数据、角色扮演场景、会话记录。
  - 支持数据的增删改查。
  - 提供数据初始化和迁移功能。
- **后端实现**：
  - **控制层**：提供 CRUD 操作的 RESTful API。
  - **服务层**：处理数据操作逻辑，确保一致性。
  - **数据访问层**：MyBatis Plus 执行 SQL 查询，初始化脚本位于 `backend/sql/`。
- **前端实现**：
  - **展示层**：渲染数据管理界面（如场景列表、会话历史）。
  - **API 集成**：调用后端 CRUD API 显示和更新数据。
- **数据存储**：MySQL 存储所有持久化数据，Redis 缓存高频数据。

### 3.5. 性能优化模块
- **职责**：
  - 通过缓存减少数据库负载。
  - 优化 API 响应速度。
- **后端实现**：
  - **缓存模块**：Redis 缓存用户会话、场景模板等。
  - **服务层**：实现缓存优先策略，定期失效缓存。
  - **控制层**：WebFlux 响应式编程支持高并发。
- **前端实现**：
  - **展示层**：React 虚拟 DOM 优化 UI 渲染。
  - **API 集成**：实现加载状态和错误处理，提升用户体验。
- **数据存储**：Redis 提供低延迟缓存，MySQL 支持索引优化。

### 3.6. 配置管理模块
- **职责**：
  - 管理前后端运行配置。
  - 支持开发和生产环境切换。
- **后端实现**：
  - **配置模块**：`application.yml` 配置数据库、Redis、端口（默认 8080）。
- **前端实现**：
  - **配置模块**：`.env` 配置后端 API 地址、端口（默认 3000）。
- **数据存储**：配置文件存储在 `backend/src/main/resources/` 和 `front-end/.env`。

## 4. 模块交互

- **用户交互流程**：
  - 用户通过前端登录，调用后端认证 API 获取 JWT。
  - 前端携带 JWT 请求角色扮演或数据管理 API，后端验证权限后响应。
- **数据流**：
  - 后端服务层协调 MySQL 和 Redis，优先从 Redis 获取缓存数据。
  - 数据访问层执行 MySQL 查询，更新持久化数据。
- **安全交互**：
  - JWT 在前后端间传递，Spring Security 验证请求权限。
  - Redis 缓存 token 确保快速会话验证。

</xaiArtifact>