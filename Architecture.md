

# AI Roleplay 项目架构文档

## 1. 概述

AI Roleplay 是一个基于人工智能的角色扮演全栈 Web 应用，采用 Spring Boot WebFlux 后端和 React 前端，提供交互式角色扮演体验。系统通过 RESTful API 实现前后端分离，使用 MySQL 存储持久化数据，Redis 进行缓存，Spring Security 和 JWT 确保安全认证和授权。

## 2. 系统架构

项目采用客户端-服务器架构，主要组件如下：

- **前端**：基于 React 的单页应用（SPA），负责用户界面和客户端逻辑。
- **后端**：基于 Spring Boot WebFlux 的响应式应用，提供 RESTful API。
- **数据库**：MySQL 用于存储用户、角色扮演场景等数据。
- **缓存**：Redis 用于缓存高频数据，提升性能。

前端通过 HTTP 请求与后端 API 通信，后端处理请求、执行业务逻辑，并与数据库和缓存交互。

## 3. 后端架构

后端基于 Spring Boot WebFlux，采用响应式编程，支持高并发，模块化设计如下：

### 3.1. 后端模块

#### 3.1.1. 应用层
- **职责**：Spring Boot 应用入口，初始化应用上下文，配置日志、端口（默认 8080）等。
- **位置**：`src/main/java/com.hzau/BackendApplication`。

#### 3.1.2. 控制层
- **职责**：处理 HTTP 请求和响应，提供 RESTful API（如用户认证、角色扮演数据操作）。
- **特性**：使用 WebFlux 的 `Mono` 和 `Flux` 实现非阻塞响应。

#### 3.1.3. 服务层
- **职责**：处理业务逻辑，如用户管理、角色扮演会话处理，与数据访问层和缓存交互。
- **特性**：模块化服务设计，分领域处理（如用户服务、角色扮演服务）。

#### 3.1.4. 数据访问层
- **职责**：通过 MyBatis Plus 实现数据库操作，管理用户、角色扮演场景等实体。
- **特性**：支持响应式数据库访问，执行 `sql/` 目录下的初始化脚本。

#### 3.1.5. 安全模块
- **职责**：使用 Spring Security 和 JWT 实现认证和授权，保护 API 安全。
- **特性**：支持基于角色的访问控制，密码哈希存储。

#### 3.1.6. 缓存模块
- **职责**：使用 Redis 缓存用户会话、角色扮演模板等数据，降低数据库压力。
- **特性**：支持缓存失效和更新策略。

#### 3.1.7. 配置模块
- **职责**：管理 `application.yml` 中的配置（如数据库、Redis 连接、端口）。
- **特性**：支持开发和生产环境配置。

## 4. 前端架构

前端为基于 React 的单页应用，使用 Create React App 构建，提供交互式界面。

### 4.1. 前端模块

#### 4.1.1. 展示层
- **职责**：渲染用户界面，使用 Ant Design 和 Material-UI 组件，支持响应式设计。
- **特性**：组件化设计，动态更新 UI。

#### 4.1.2. 状态管理
- **职责**：管理客户端状态（如用户会话、角色扮演数据）。
- **特性**：使用 React 的 useState、useReducer 和 Context API。

#### 4.1.3. API 集成
- **职责**：通过 HTTP 请求与后端 API 通信，处理认证和数据更新。
- **特性**：使用 Axios 或 Fetch，支持错误处理和加载状态。

#### 4.1.4. 静态资源
- **职责**：管理 `public/` 目录下的静态文件（如图片、图标）。
- **特性**：优化生产环境加载速度。

#### 4.1.5. 配置模块
- **职责**：管理 `.env` 文件中的配置（如后端 API 地址、端口 3000）。
- **特性**：支持开发和生产环境。

## 5. 数据库与缓存

### 5.1. MySQL 数据库
- **职责**：存储用户、角色扮演场景等数据，支持复杂查询。
- **特性**：使用 UTF-8 编码（`utf8mb4_unicode_ci`），通过 `backend/sql/` 初始化。

### 5.2. Redis 缓存
- **职责**：缓存高频数据（如会话、模板），提升性能。
- **特性**：高性能内存存储，可配置缓存策略。

## 6. 组件交互

- **前后端交互**：前端通过 RESTful API 与后端通信，使用 JWT 进行认证。
- **后端与数据库/缓存**：服务层协调 MyBatis Plus 与 MySQL、Redis 交互。
- **安全流程**：用户登录生成 JWT，前端携带 token 访问受保护资源。

